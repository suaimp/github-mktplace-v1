import { execSync } from 'child_process'

console.log('üîß Reparando hist√≥rico de migrations e criando schema inicial...')

// Lista das migrations que precisam ser marcadas como revertidas
const migrationsToRevert = [
  '20250312221544', '20250312224527', '20250312225637', '20250313002547', '20250313010201',
  '20250313010310', '20250313031303', '20250313031626', '20250313032705', '20250313032833',
  '20250313034607', '20250313045153', '20250313045805', '20250313234438', '20250313234553',
  '20250313234659', '20250313234751', '20250314000102', '20250314000348', '20250314000622',
  '20250314000807', '20250314001438', '20250314001747', '20250314001836', '20250314001918',
  '20250315165201', '20250315170644', '20250315171100', '20250315175227', '20250315181912',
  '20250316172552', '20250316172823', '20250316185730', '20250316212222', '20250316212404',
  '20250316220943', '20250316221010', '20250316224611', '20250316233921', '20250320004404',
  '20250320004542', '20250320131221', '20250320143121', '20250320194412', '20250320195055',
  '20250320200920', '20250320212222', '20250320223923', '20250320224741', '20250321001952',
  '20250321002144', '20250322170948', '20250322174625', '20250322194532', '20250322195118',
  '20250322204232', '20250322205718', '20250322210830', '20250322212523', '20250322232047',
  '20250323001623', '20250323023818', '20250323025617', '20250323032807', '20250323033022',
  '20250323140759', '20250323143602', '20250323145410', '20250323153642', '20250323155428',
  '20250323172826', '20250323173759', '20250323185225', '20250323194255', '20250323195805',
  '20250323200240', '20250323201457', '20250323202004', '20250323202213', '20250323202420',
  '20250323202611', '20250323205126', '20250323212352', '20250324172745', '20250324182846',
  '20250324183033', '20250324184335', '20250329163343', '20250329165804', '20250329170555',
  '20250329170857', '20250329173839', '20250329175409', '20250329175724', '20250329180414',
  '20250329181358', '20250329182006', '20250329193041', '20250329194846', '20250329201806',
  '20250329204351', '20250329210254', '20250329213020', '20250330020855', '20250330021408',
  '20250330022009', '20250330022202', '20250330022420', '20250330022811', '20250330023132',
  '20250401023204', '20250401023304', '20250404013656', '20250404025057', '20250404033308',
  '20250404033839', '20250410013437', '20250410014346', '20250410022015', '20250410024216',
  '20250410025713', '20250410034923', '20250424021428', '20250424021834', '20250424022830',
  '20250424023723', '20250424025422', '20250424030109', '20250424030728', '20250424030920',
  '20250424031222', '20250424031538', '20250424032332', '20250424124024', '20250424151323',
  '20250424152449', '20250424155430', '20250424172723', '20250424180143', '20250424182036',
  '20250426215514', '20250426220421', '20250426221624', '20250427003259', '20250427223517',
  '20250427224558', '20250427225404', '20250428010827', '20250428012901', '20250428015713',
  '20250503135315', '20250505024853', '20250505030749', '20250505030942', '20250505031126',
  '20250505031420', '20250505031639', '20250505031854', '20250505032250', '20250505032415',
  '20250508001455', '20250508002230', '20250508002932', '20250508003227', '20250508003402',
  '20250508003903', '20250508005942', '20250508010151', '20250508010515', '20250508011158',
  '20250519022748', '20250519024031', '20250519024032', '20250604184702', '20250604223153',
  '20250605165430', '20250605170404', '20250605171213', '20250605173742', '20250605174459',
  '20250605175331', '20250605180745', '20250605181858', '20250606000346', '20250606005407'
]

console.log(`üìã Marcando ${migrationsToRevert.length} migrations como revertidas...`)

// Marcar todas as migrations como revertidas
for (const migration of migrationsToRevert) {
  try {
    console.log(`‚ö° Revertendo migration: ${migration}`)
    execSync(`supabase migration repair --status reverted ${migration}`, { stdio: 'pipe' })
  } catch (error) {
    console.log(`‚ö†Ô∏è  Migration ${migration} j√° revertida ou erro: ${error.message.split('\n')[0]}`)
  }
}

console.log('‚úÖ Hist√≥rico de migrations limpo!')
console.log('üì• Fazendo pull do schema da produ√ß√£o...')

try {
  execSync('supabase db pull', { stdio: 'inherit' })
  console.log('üéâ Schema sincronizado com sucesso!')
  console.log('üìÅ Verifique a pasta supabase/migrations/')
} catch (error) {
  console.error('‚ùå Erro ao fazer pull do schema:', error.message)
}
